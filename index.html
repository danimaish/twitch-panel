<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Patreon Locke Twitch - Pok√©mon League</title>
<link rel="icon" href="assets/favicon.ico" type="image/x-icon">

<style>
/* BODY */
body {
  font-family: Arial, sans-serif;
  padding: 15px 30px 30px;
  color: white;
  background-image:
    linear-gradient(rgba(0,0,0,0.55), rgba(0,0,0,0.55)),
    url('assets/Kanto.png');
  background-size: cover;
  background-position: center;
}

/* TITULO */
h1 {
  text-align: center;
  margin-bottom: 25px;
}

/* GRID STREAMERS */
#list {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 20px;
}

/* TARJETA */
.streamer {
  background: rgba(30,30,30,0.92);
  border-radius: 12px;
  padding: 20px;
  cursor: pointer;
  min-height: 180px;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  border: 2px solid transparent;
  transition: transform 0.2s, box-shadow 0.2s;
}

.streamer:hover {
  transform: translateY(-3px);
  box-shadow: 0 10px 20px rgba(255,255,255,0.2);
}

/* ONLINE */
.streamer.online-card {
  border: 2px solid #00ff7f;
  animation: pulse 1.5s infinite;
}

@keyframes pulse {
  0% { box-shadow: 0 0 5px #00ff7f; }
  50% { box-shadow: 0 0 18px #00ff7f; }
  100% { box-shadow: 0 0 5px #00ff7f; }
}

/* TOP */
.top {
  display: flex;
  align-items: center;
  gap: 12px;
}

.avatar {
  width: 60px;
  height: 60px;
  border-radius: 50%;
}

/* INFO */
.info {
  display: flex;
  flex-direction: column;
  font-size: 0.95em;
}

.title {
  font-weight: bold;
  word-wrap: break-word;
}

.category {
  color: #ccc;
}

.badges {
  display: flex;
  gap: 4px;
  margin-top: 6px;
}

.badge {
  width: 20px;
  height: 20px;
  opacity: 0.2;
}

.badge.active {
  opacity: 1;
}

.deaths {
  color: #ff6666;
  font-size: 0.85em;
  margin-top: 4px;
}

.status {
  font-weight: bold;
  margin-top: 8px;
}

.offline {
  color: rgba(255,255,255,0.6);
}

/* RANKINGS */
#rankings {
  margin-top: 50px;
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 40px;
}

.ranking {
  background: rgba(20,20,20,0.85);
  padding: 20px;
  border-radius: 12px;
}

.ranking h2 {
  margin-bottom: 15px;
}

.ranking ul {
  list-style: none;
  padding: 0;
  margin: 0;
}

.ranking li {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 8px;
  font-weight: bold;
}

.ranking-avatar {
  width: 28px;
  height: 28px;
  border-radius: 50%;
}

/* RESPONSIVE */
@media(max-width: 1200px){
  #list { grid-template-columns: repeat(3, 1fr); }
}
@media(max-width: 900px){
  #list { grid-template-columns: repeat(2, 1fr); }
  #rankings { grid-template-columns: 1fr; }
}
@media(max-width: 600px){
  #list { grid-template-columns: 1fr; }
}
</style>
</head>

<body>

<h1>üéÆ Streamers Patreon Locke</h1>

<div id="list"></div>

<div id="rankings">
  <div class="ranking">
    <h2>üèÖ Ranking de Medallas</h2>
    <ul id="ranking-badges"></ul>
  </div>
  <div class="ranking">
    <h2>‚ò†Ô∏è Ranking de Muertes</h2>
    <ul id="ranking-deaths"></ul>
  </div>
</div>

<script>
function formatTime(started) {
  const start = new Date(started);
  const now = new Date();
  let diff = Math.floor((now - start)/1000);
  const h = Math.floor(diff/3600); diff %= 3600;
  const m = Math.floor(diff/60); diff %= 60;
  return `${h.toString().padStart(2,"0")}:${m.toString().padStart(2,"0")}:${diff.toString().padStart(2,"0")}`;
}

/* DATOS LOCKE */
const streamerLocke = {
  arnauz10:{badges:1,deaths:5},
  kikoelquelon:{badges:0,deaths:0},
  lolnezan78:{badges:2,deaths:2},
  novaiosca:{badges:0,deaths:0},
  azogil:{badges:4,deaths:10},
  sitinho6:{badges:2,deaths:3},
  sqdgiorgi:{badges:1,deaths:2},
  tvcharliestoltes:{badges:1,deaths:0},
  raulito21:{badges:1,deaths:4},
  troncito999:{badges:3,deaths:14},
  sasen82:{badges:4,deaths:4},
  carr0quin:{badges:4,deaths:9},
  archyx05:{badges:0,deaths:0},
  naniroma:{badges:3,deaths:6},
  kstillopkm:{badges:4,deaths:12},
  jaborro95gordo:{badges:2,deaths:2}
};

const medallas = [
  "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/badges/1.png",
  "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/badges/2.png",
  "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/badges/3.png",
  "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/badges/4.png",
  "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/badges/5.png",
  "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/badges/6.png",
  "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/badges/7.png",
  "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/badges/8.png"
];

async function load() {
  const res = await fetch("/.netlify/functions/streams");
  const data = await res.json();

  const container = document.getElementById("list");
  container.innerHTML = "";

  const online = data.all.filter(n => data.online.includes(n));
  const offline = data.all.filter(n => !data.online.includes(n));

  [...online, ...offline].forEach(name => {
    const isOnline = data.online.includes(name);
    const stream = data.streamInfo[name] || {};
    const locke = streamerLocke[name];

    let badgeHTML = "";
    medallas.forEach((m,i)=>{
      badgeHTML += `<img src="${m}" class="badge ${i<locke.badges?'active':''}">`;
    });

    const div = document.createElement("div");
    div.className = "streamer" + (isOnline?" online-card":"");

    div.innerHTML = `
      <div class="top">
        <img src="${data.logos[name]}" class="avatar">
        <div class="info">
          <strong>${name}</strong>
          ${stream.title?`<span class="title">${stream.title}</span>`:""}
          ${stream.game?`<span class="category">üéÆ ${stream.game}</span>`:""}
          ${isOnline?`<span class="stream-timer" data-started="${stream.started_at}">‚è± 00:00:00</span>`:""}
          <div class="badges">${badgeHTML}</div>
          ${locke.deaths?`<div class="deaths">üíÄ ${locke.deaths} muertes</div>`:""}
        </div>
      </div>
      <span class="status ${isOnline?'':'offline'}">${isOnline?'üü¢ ONLINE':'‚ö´ OFFLINE'}</span>
    `;

    div.onclick = ()=>window.open(`https://twitch.tv/${name}`,"_blank");
    container.appendChild(div);
  });

  renderRankings(data.logos);
}

function renderRankings(logos){
  const medals = ["ü•á","ü•à","ü•â"];
  const badgeList = document.getElementById("ranking-badges");
  const deathList = document.getElementById("ranking-deaths");

  badgeList.innerHTML = "";
  deathList.innerHTML = "";

  Object.entries(streamerLocke)
    .sort((a,b)=>b[1].badges-a[1].badges)
    .filter(e=>e[1].badges>0)
    .forEach(([name,data],i)=>{
      badgeList.innerHTML += `
        <li>
          ${medals[i]||"üèÖ"}
          <img src="${logos[name]}" class="ranking-avatar">
          ${name} ‚Äî ${data.badges}
        </li>`;
    });

  Object.entries(streamerLocke)
    .sort((a,b)=>b[1].deaths-a[1].deaths)
    .filter(e=>e[1].deaths>0)
    .forEach(([name,data],i)=>{
      deathList.innerHTML += `
        <li>
          ${medals[i]||"‚ò†Ô∏è"}
          <img src="${logos[name]}" class="ranking-avatar">
          ${name} ‚Äî ${data.deaths}
        </li>`;
    });
}

setInterval(()=>{
  document.querySelectorAll(".stream-timer").forEach(t=>{
    t.textContent = "‚è± "+formatTime(t.dataset.started);
  });
},1000);

load();
setInterval(load,60000);
</script>

</body>
</html>
