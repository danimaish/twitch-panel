<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Patreon Locke Twitch - Pok√©mon League</title>
<style>
/* BODY Y TEMA */
body {
  font-family: Arial, sans-serif;
  padding: 30px;
  transition: background 0.3s, color 0.3s;
  color: white;
  background-image: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)), url('assets/Kanto.png');
  background-size: cover;
  background-position: center;
}
body.light {
  color: black;
  background-image: linear-gradient(rgba(255,255,255,0.4), rgba(255,255,255,0.4)), url('assets/Kanto.png');
}

/* TITULO Y BOTON */
h1 { text-align: center; margin-bottom: 20px; }
#toggleTheme { display:block; margin:0 auto 25px; cursor: pointer; padding: 8px 14px; border-radius: 6px; }

/* GRID TABLERO */
#list {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 20px;
}

/* TARJETA STREAMER */
.streamer {
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  padding: 20px;
  border-radius: 12px;
  cursor: pointer;
  position: relative;
  overflow: hidden;
  min-height: 180px;
  background: rgba(30,30,30,0.9); /* tarjeta s√≥lida */
  transition: transform 0.2s, box-shadow 0.2s, border 0.3s;
  border: 2px solid transparent;
}

/* TARJETA ONLINE */
.streamer.online-card {
  animation: pulse 1.5s infinite;
  border: 2px solid #00ff7f;
}

/* PULSING ANIMATION */
@keyframes pulse {
  0% { box-shadow: 0 0 5px #00ff7f; }
  50% { box-shadow: 0 0 20px #00ff7f; }
  100% { box-shadow: 0 0 5px #00ff7f; }
}

/* HOVER ANIMADO */
.streamer:hover {
  transform: translateY(-3px);
  box-shadow: 0 10px 20px rgba(255,255,255,0.2);
}

/* ESTADOS ONLINE / OFFLINE */
.online { font-weight: bold; }
.offline { font-weight: bold; color: rgba(255,255,255,0.6); }

/* TOP: AVATAR + NOMBRE + POK√âBALL */
.top { display: flex; align-items: center; margin-bottom: 12px; }
.avatar { width: 60px; height: 60px; border-radius: 50%; margin-right: 12px; }
.pokeball { width: 20px; height: 20px; margin-right: 6px; vertical-align: middle; }

/* INFO STREAMER */
.info { display: flex; flex-direction: column; font-size: 0.95em; margin-top: 6px; }
.info .title { font-weight: bold; margin-bottom: 4px; word-wrap: break-word; }
.info .category { font-weight: normal; color: #ccc; }
.info .badges { margin-top: 6px; display: flex; align-items: center; }
.badge { width: 20px; height: 20px; margin-right: 4px; }
.info .deaths { margin-top: 4px; font-size: 0.85em; color: #ff6666; }

/* ESTADO */
.status { font-weight:bold; margin-top: 8px; }

/* RESPONSIVE */
@media(max-width: 1200px){ #list { grid-template-columns: repeat(3, 1fr); } }
@media(max-width: 900px){ #list { grid-template-columns: repeat(2, 1fr); } }
@media(max-width: 600px){ #list { grid-template-columns: 1fr; } }
</style>
</head>
<body>
<h1>üéÆ Streamers Patreon Locke</h1>
<button id="toggleTheme">üåó Cambiar tema</button>
<div id="list"></div>

<script>
const body2 = document.body;
document.getElementById("toggleTheme").onclick = () => {
  body2.classList.toggle("light");
};

// Formato de tiempo
function formatTime(started) {
  if(!started) return "";
  const start = new Date(started);
  const now = new Date();
  let diff = Math.floor((now - start)/1000);
  const h = Math.floor(diff/3600); diff %= 3600;
  const m = Math.floor(diff/60); diff %= 60;
  const s = diff;
  return `${h.toString().padStart(2,"0")}:${m.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`;
}

// Datos extra Locke
const streamerLocke = {
  "arnauz10": { badges: 0, deaths: 0 },
  "kikoelquelon": { badges: 0, deaths: 0 },
  "lolnezan78": { badges: 0, deaths: 0 },
  "novaiosca": { badges: 0, deaths: 0 },
  "azogil": { badges: 0, deaths: 0 },
  "sitinho6": { badges: 0, deaths: 0 },
  "sqdgiorgi": { badges: 0, deaths: 0 },
  "tvcharliestoltes": { badges: 0, deaths: 0 },
  "raulito21": { badges: 0, deaths: 2 },
  "troncito999": { badges: 0, deaths: 0 },
  "sasen82": { badges: 0, deaths: 0 },
  "carr0quin": { badges: 0, deaths: 0 },
  "archyx05": { badges: 0, deaths: 0 },
  "naniroma": { badges: 0, deaths: 0 },
  "kstillopkm": { badges: 0, deaths: 0 },
  "jaborro95gordo": { badges: 0, deaths: 0 },
  "auronplay": { badges: 0, deaths: 0 },
  "elxokas": { badges: 0, deaths: 0 },
  "ibai": { badges: 0, deaths: 0 }
};

// Limitar longitud de caracteres
function truncate(str, max) {
  return str.length > max ? str.slice(0, max - 1) + "‚Ä¶" : str;
}

async function load() {
  try {
    const res = await fetch("/.netlify/functions/streams");
    const data = await res.json();

    const onlineList = data.all.filter(name => data.online.includes(name));
    const offlineList = data.all.filter(name => !data.online.includes(name));

    const container = document.getElementById("list");
    container.innerHTML = "";

    function renderList(list){
      list.forEach(name => {
        const div = document.createElement("div");
        div.className = "streamer";

        const isOnline = data.online.includes(name);
        if(isOnline) div.classList.add("online-card");

        const status = isOnline ? "üü¢ ONLINE" : "‚ö´ OFFLINE";
        const statusClass = isOnline ? "online" : "offline";

        const stream = data.streamInfo[name] || {};
        const title = stream.title || "";
        const game = stream.game || "";
        const viewers = stream.viewers || "";
        const started = stream.started_at || "";

        const pokeball = "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/items/poke-ball.png";

        const badges = streamerLocke[name]?.badges || 0;
        const deaths = streamerLocke[name]?.deaths || 0;

        let badgeHTML = "";
        for(let i=0; i<badges; i++){
          badgeHTML += `<img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/items/relic-gold.png" class="badge" alt="Badge">`;
        }

        div.innerHTML = `
          <div class="top">
            <img src="${data.logos[name]}" class="avatar" alt="Logo ${name}">
            <div>
              <span><img src="${pokeball}" class="pokeball" alt="Pokeball">${name}</span>
              <div class="info">
                ${title ? `<span class="title">${title}</span>` : ""}
                ${game ? `<span class="category">üéÆ ${game}</span>` : ""}
                ${viewers && isOnline ? `<span>üëÄ ${viewers}</span>` : ""}
                ${started && isOnline ? `<span class="stream-timer" data-started="${started}">‚è± 00:00:00</span>` : ""}
                ${badgeHTML ? `<div class="badges">${badgeHTML}</div>` : ""}
                ${deaths ? `<div class="deaths">üíÄ Pok√©mon muertos: ${deaths}</div>` : ""}
              </div>
            </div>
          </div>
          <span class="${statusClass} status">${status}</span>
        `;

        div.onclick = () => {
          window.open(`https://twitch.tv/${name}`, "_blank");
        };

        container.appendChild(div);
      });
    }

    renderList(onlineList);
    renderList(offlineList);

  } catch(err) {
    console.error("Error cargando streams", err);
  }
}

// Actualiza contadores de tiempo
function updateTimers() {
  document.querySelectorAll(".stream-timer").forEach(span => {
    const started = span.dataset.started;
    if(started){
      span.textContent = `‚è± ${formatTime(started)}`;
    }
  });
}

load();
setInterval(load, 60000);
setInterval(updateTimers, 1000);
</script>
</body>
</html>
